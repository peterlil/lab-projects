# Test authentication

##

Requires Access Token v2, then the client id is returned in the aud-claim.

## Very manual

Go to this URL with browser, using work profile.

```PowerShell
$clientId="1dc4c222-ca93-4a48-9c25-59fed9bb9e3d"
$redirectUri="http://localhost:7071"
$tenant="fdpo.onmicrosoft.com"

#"https://login.microsoftonline.com/$tenant/oauth2/v2.0/authorize?response_type=code&client_id=$clientId&redirect_uri=$redirectUri&scope=openid"
"https://login.microsoftonline.com/$tenant/oauth2/v2.0/authorize?response_type=code&client_id=$clientId&redirect_uri=$redirectUri&scope=openid&response_mode=query"
```

Sample response (from the address bar):
```
http://localhost:7071/?code=0.ARoAE8CzFgDTjUasZH7aCCC20yLCxB2TykhKnCVZ_tm7nj0aAB8.AgABAAIAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P9TamHXywKAR_tbC6XDpBAlMo-GvU5AjO3NjNpDKNMLJ3lEUgT1itXGsFY73zzGyTVv4k2COmInoklIBg7d_QX_Wb6e5_g7ej1M-At0XhTr9HGEtiLz-rPu22Gy4RNFhRYlHgO_brJnorf6uHFtGNufO6EjyjeXBlRN2Dpu55h0iykboHMnYMBN4L25Aosyoyq2V0levlUsal6-gBmVmAy9fT3Z9uluvT9jO40ME0BaNYJe_6ZWCVdHLUbxoBaKopFevDVde_ZBjQCS8veGi21iSWnDnVeWqyVebzFjkyNsK0yiyl6_aENLDqhAWR3phigKdKGIebVWooIyY00rZeH13D6JdKHG-N4VBKzy0OLMp6BL5RCzfdqWIlL9LUjnjJgGsSyrCfpYaUQx9piixXpshyJVfy0J9GjwZtSyXv-BEB2oBweMUWaKdYrRpbrlUFQHuqgj59HHsAvyrr4yZ13Y6Kgybe3t2GGmjQE3JgSqUE6QJAPBS4SGoj6A3oiHa8LXjR-yI3HN9khpGYgqCvoTlY6smAjkh4vKS86yhrXkOKCzE0zfK2QEcNdd1lEpEQBjCGy97PcKooecURw-YedyVU_-2vfJZpyoA8GH745XgWzqww9B6XMcw9jlcMLBT3JJrSX7ChVm9JUr26-S5dusn7VIETs2DkJ3KNiLSuYGeJcbmN6roETp_60Zco0JFdir7UKgcyn_Bx-PCbpWjm36HSw5Q11hCPiSv1m8b3AFKKS_a9R4-Re8K2U9ywhuXQntEKb4ac5uLLyikUjU0fyii9FU4PhCBUTwqERnjvVhtv2ujFPM1OGHbGL3fZcJc5pH48Jpcrf0k1L1SECMOYKHbn7o34wLA0pQCvljvZn9epiDmD3xQmJRnAJOmLlWOCEu4ndvbFDuNlVvjPgXQBsv7zV9rmh0-Y-Y8MJaETh8Gzm-hkVII98sj7xBoTdsYYEZxIcrL6c5I9g-GMA_QyWPGfq4L8KyFOnadDcVgcbwjTkMMcH9U6MfYcwdMc7CY6q-Q8AwDgBGg8QMuiqbnA-ch-Ogoo3CGU8l&session_state=464ad9dc-0872-42a0-beaf-0113b3e1830e
```

Take the code from the URL and use it to get the token:

```bash
redirectUri=http%3A%2F%2Flocalhost:7071

clientId=1dc4c222-ca93-4a48-9c25-59fed9bb9e3d
#clientId="https%3A%2F%2Ffuncapi_python_flask.fdpo.onmicrosoft.com"

code=0.ARoAE8CzFgDTjUasZH7aCCC20yLCxB2TykhKnCVZ_tm7nj0aAB8.AgABAAIAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P9TamHXywKAR_tbC6XDpBAlMo-GvU5AjO3NjNpDKNMLJ3lEUgT1itXGsFY73zzGyTVv4k2COmInoklIBg7d_QX_Wb6e5_g7ej1M-At0XhTr9HGEtiLz-rPu22Gy4RNFhRYlHgO_brJnorf6uHFtGNufO6EjyjeXBlRN2Dpu55h0iykboHMnYMBN4L25Aosyoyq2V0levlUsal6-gBmVmAy9fT3Z9uluvT9jO40ME0BaNYJe_6ZWCVdHLUbxoBaKopFevDVde_ZBjQCS8veGi21iSWnDnVeWqyVebzFjkyNsK0yiyl6_aENLDqhAWR3phigKdKGIebVWooIyY00rZeH13D6JdKHG-N4VBKzy0OLMp6BL5RCzfdqWIlL9LUjnjJgGsSyrCfpYaUQx9piixXpshyJVfy0J9GjwZtSyXv-BEB2oBweMUWaKdYrRpbrlUFQHuqgj59HHsAvyrr4yZ13Y6Kgybe3t2GGmjQE3JgSqUE6QJAPBS4SGoj6A3oiHa8LXjR-yI3HN9khpGYgqCvoTlY6smAjkh4vKS86yhrXkOKCzE0zfK2QEcNdd1lEpEQBjCGy97PcKooecURw-YedyVU_-2vfJZpyoA8GH745XgWzqww9B6XMcw9jlcMLBT3JJrSX7ChVm9JUr26-S5dusn7VIETs2DkJ3KNiLSuYGeJcbmN6roETp_60Zco0JFdir7UKgcyn_Bx-PCbpWjm36HSw5Q11hCPiSv1m8b3AFKKS_a9R4-Re8K2U9ywhuXQntEKb4ac5uLLyikUjU0fyii9FU4PhCBUTwqERnjvVhtv2ujFPM1OGHbGL3fZcJc5pH48Jpcrf0k1L1SECMOYKHbn7o34wLA0pQCvljvZn9epiDmD3xQmJRnAJOmLlWOCEu4ndvbFDuNlVvjPgXQBsv7zV9rmh0-Y-Y8MJaETh8Gzm-hkVII98sj7xBoTdsYYEZxIcrL6c5I9g-GMA_QyWPGfq4L8KyFOnadDcVgcbwjTkMMcH9U6MfYcwdMc7CY6q-Q8AwDgBGg8QMuiqbnA-ch-Ogoo3CGU8l

clientSecret=0EE8Q~_TtuBGtbiIwwSsM5dESvGm7pl4KqqTMajB

scope=https%3A%2F%2Ffuncapi_python_flask.fdpo.onmicrosoft.com%2Fuser_impersonation

curl -X POST \
  https://login.microsoftonline.com/fdpo.onmicrosoft.com/oauth2/v2.0/token \
  -H 'Accept: */*' \
  -H 'Cache-Control: no-cache' \
  -H 'Connection: keep-alive' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'Host: login.microsoftonline.com' \
  -H 'accept-encoding: gzip, deflate' \
  -H 'cache-control: no-cache' \
  -d "redirect_uri=$redirectUri&client_id=$clientId&grant_type=authorization_code&code=$code&client_secret=$clientSecret&scope=$scope"
```

Sample response
```
{"token_type":"Bearer","scope":"https://funcapi_python_flask.fdpo.onmicrosoft.com/user_impersonation","expires_in":5101,"ext_expires_in":5101,
    "access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiIxZGM0YzIyMi1jYTkzLTRhNDgtOWMyNS01OWZlZDliYjllM2QiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vMTZiM2MwMTMtZDMwMC00NjhkLWFjNjQtN2VkYTA4MjBiNmQzL3YyLjAiLCJpYXQiOjE2NjQ5ODM4ODMsIm5iZiI6MTY2NDk4Mzg4MywiZXhwIjoxNjY0OTg5Mjg1LCJhaW8iOiJBYlFBUy84VEFBQUF1MERsNnJJRTBDWGtaeWxTT0RkQkIvQ3V3RFZwRVpka24yM0tmM1Z6Uk5uekdlakhlNTRvRmFNSnNVckhSZmw3N3pOMkpBYU14RGorZmdaY0RDSW1HYWw1ZklPQk1OcHZTZENoUzBjeHRFb2d2S0JTWFFQZ2RzNnc3VHE0UmRFNXBLblBQZmxLd1NCMFJESE83YkJiKzBSKzZMRGpLYlppZ21ZSnQzeDNSbUdFVGdrNjZlTklaY3dUOFVrcUJGVWNZY2dEWk04dDQ0bzloSUdVRmdUaTUzeFMwbE5mLy9pelNMU3FMaFEyUVA0PSIsImF6cCI6IjFkYzRjMjIyLWNhOTMtNGE0OC05YzI1LTU5ZmVkOWJiOWUzZCIsImF6cGFjciI6IjEiLCJpZHAiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC83MmY5ODhiZi04NmYxLTQxYWYtOTFhYi0yZDdjZDAxMWRiNDcvIiwibmFtZSI6IlBldGVyIExpbGplbnJvdGgiLCJvaWQiOiJmMGYzYTZmOC1lMDYyLTRkYjUtYTc1Mi0yODFjNzJjZjU5ZmYiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJwZXRlcmxpbEBtaWNyb3NvZnQuY29tIiwicmgiOiIwLkFVWUFFOEN6RmdEVGpVYXNaSDdhQ0NDMjB5TEN4QjJUeWtoS25DVlpfdG03bmoyQUFCOC4iLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJWaWwwYVhpOS1JN0cxcWdxS2U5Wld5S1FxOEVERTBhcXB3Wm9YckdzQ0NrIiwidGlkIjoiMTZiM2MwMTMtZDMwMC00NjhkLWFjNjQtN2VkYTA4MjBiNmQzIiwidXRpIjoiVVpBSDMzRnk3VUdhdG9WX09iWVJBQSIsInZlciI6IjIuMCJ9.qUbB8R5un_kooeMu_QpeHRaX8x3kV8SQqsXSxKUYgNN_5beJThyblf6ZLoYJi-IeutdJeQua4siLkp728JwLWPCIltnPwHOCoQUs1YYPxg-efw36G8CnhmpPe6EkDs-HEbjy6UcTjc_B-26-WfDuwDrlX__fuNhzf78rYPto3c3Ojymk9cf-G5eOzhZ9QLjSJcQ8qehZRa5lSf9klwtVvWTEgPaqgVAoM6NWz085_8N3rXGu8oXIWhsHkgl5x0e_psuKzh7n6_i_OONYX5fPjD3kVb7qoG5OJ4K4UCC5wvpy1I9W-64hEaaIVY_PxHqd8a_rEyZV8g7IIoHmFjlB9Q"
    ,"id_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiIxZGM0YzIyMi1jYTkzLTRhNDgtOWMyNS01OWZlZDliYjllM2QiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vMTZiM2MwMTMtZDMwMC00NjhkLWFjNjQtN2VkYTA4MjBiNmQzL3YyLjAiLCJpYXQiOjE2NjQ5ODM4ODMsIm5iZiI6MTY2NDk4Mzg4MywiZXhwIjoxNjY0OTg3NzgzLCJpZHAiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC83MmY5ODhiZi04NmYxLTQxYWYtOTFhYi0yZDdjZDAxMWRiNDcvIiwicmgiOiIwLkFVWUFFOEN6RmdEVGpVYXNaSDdhQ0NDMjB5TEN4QjJUeWtoS25DVlpfdG03bmoyQUFCOC4iLCJzdWIiOiJWaWwwYVhpOS1JN0cxcWdxS2U5Wld5S1FxOEVERTBhcXB3Wm9YckdzQ0NrIiwidGlkIjoiMTZiM2MwMTMtZDMwMC00NjhkLWFjNjQtN2VkYTA4MjBiNmQzIiwidXRpIjoiVVpBSDMzRnk3VUdhdG9WX09iWVJBQSIsInZlciI6IjIuMCJ9.TjOR8_mCxIwrWTPis4SslgE05AhAxirswCuz40QdBZLkE6VnNArwf19fAe0zKW_64pffljbu-8KJn8ruHoeUmIAM07_9HLV-CU17VtrwnWHvZs14CQslJHkPDQWQZvZ6oVnvFnASR_KUiIQv4pKXl7tRxazH2-2KSC07IiC1k_EGW-_VtVN18xxjUXkLQsR-T8kEtbL-21U82tEXSTG08FdUpCo-2vrMvQ7sWT8CV_uJo760JqL6NcQQJmJaZDaMjzhKxvEMQZFt4r2mqCbjZPQKJtluw8WdWiMFeX8bhT-ZF7zW9FJTOCg3mzbErqMRa0mlAXx3OEtA1uJBDeK0BA"}
```


```bash
curl \
  https://plpython.azurewebsites.net/yatchs \
  -H 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiIxZGM0YzIyMi1jYTkzLTRhNDgtOWMyNS01OWZlZDliYjllM2QiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vMTZiM2MwMTMtZDMwMC00NjhkLWFjNjQtN2VkYTA4MjBiNmQzL3YyLjAiLCJpYXQiOjE2NjQ5ODM4ODMsIm5iZiI6MTY2NDk4Mzg4MywiZXhwIjoxNjY0OTg5Mjg1LCJhaW8iOiJBYlFBUy84VEFBQUF1MERsNnJJRTBDWGtaeWxTT0RkQkIvQ3V3RFZwRVpka24yM0tmM1Z6Uk5uekdlakhlNTRvRmFNSnNVckhSZmw3N3pOMkpBYU14RGorZmdaY0RDSW1HYWw1ZklPQk1OcHZTZENoUzBjeHRFb2d2S0JTWFFQZ2RzNnc3VHE0UmRFNXBLblBQZmxLd1NCMFJESE83YkJiKzBSKzZMRGpLYlppZ21ZSnQzeDNSbUdFVGdrNjZlTklaY3dUOFVrcUJGVWNZY2dEWk04dDQ0bzloSUdVRmdUaTUzeFMwbE5mLy9pelNMU3FMaFEyUVA0PSIsImF6cCI6IjFkYzRjMjIyLWNhOTMtNGE0OC05YzI1LTU5ZmVkOWJiOWUzZCIsImF6cGFjciI6IjEiLCJpZHAiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC83MmY5ODhiZi04NmYxLTQxYWYtOTFhYi0yZDdjZDAxMWRiNDcvIiwibmFtZSI6IlBldGVyIExpbGplbnJvdGgiLCJvaWQiOiJmMGYzYTZmOC1lMDYyLTRkYjUtYTc1Mi0yODFjNzJjZjU5ZmYiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJwZXRlcmxpbEBtaWNyb3NvZnQuY29tIiwicmgiOiIwLkFVWUFFOEN6RmdEVGpVYXNaSDdhQ0NDMjB5TEN4QjJUeWtoS25DVlpfdG03bmoyQUFCOC4iLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJWaWwwYVhpOS1JN0cxcWdxS2U5Wld5S1FxOEVERTBhcXB3Wm9YckdzQ0NrIiwidGlkIjoiMTZiM2MwMTMtZDMwMC00NjhkLWFjNjQtN2VkYTA4MjBiNmQzIiwidXRpIjoiVVpBSDMzRnk3VUdhdG9WX09iWVJBQSIsInZlciI6IjIuMCJ9.qUbB8R5un_kooeMu_QpeHRaX8x3kV8SQqsXSxKUYgNN_5beJThyblf6ZLoYJi-IeutdJeQua4siLkp728JwLWPCIltnPwHOCoQUs1YYPxg-efw36G8CnhmpPe6EkDs-HEbjy6UcTjc_B-26-WfDuwDrlX__fuNhzf78rYPto3c3Ojymk9cf-G5eOzhZ9QLjSJcQ8qehZRa5lSf9klwtVvWTEgPaqgVAoM6NWz085_8N3rXGu8oXIWhsHkgl5x0e_psuKzh7n6_i_OONYX5fPjD3kVb7qoG5OJ4K4UCC5wvpy1I9W-64hEaaIVY_PxHqd8a_rEyZV8g7IIoHmFjlB9Q'

```